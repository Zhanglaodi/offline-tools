<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DBC Mini Editor</title>
  <link href="bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<nav class="navbar navbar-expand-lg bg-white border-bottom sticky-top">
  <div class="container-fluid">
    <span class="navbar-brand fw-bold">DBC Mini Editor</span>
    <div class="d-flex flex-wrap gap-2 align-items-center ms-auto">
      <button id="btnNewMsg" class="btn btn-primary btn-sm">新建消息</button>
      <button id="btnNewSig" class="btn btn-outline-primary btn-sm">添加信号</button>
      <button id="btnDelMsg" class="btn btn-outline-danger btn-sm">删除消息</button>
      <div class="vr mx-1 d-none d-md-block"></div>
      <div class="input-group input-group-sm">
        <span class="input-group-text">导入编码</span>
        <select id="selImportEnc" class="form-select form-select-sm">
          <option value="auto">自动</option>
          <option value="utf8">UTF-8</option>
          <option value="gbk">GB18030</option>
        </select>
        <input id="fileImport" type="file" class="form-control form-control-sm" accept=".dbc">
      </div>
      <div class="input-group input-group-sm">
        <span class="input-group-text">导出编码</span>
        <select id="selExportEnc" class="form-select form-select-sm">
          <option value="utf8bom">UTF-8 (BOM)</option>
          <option value="utf8">UTF-8 (无BOM)</option>
        </select>
        <button id="btnExport" class="btn btn-success btn-sm">导出 DBC</button>
      </div>
      <button id="btnToggleDensity" class="btn btn-outline-secondary btn-sm">紧凑模式</button>
    </div>
  </div>
</nav>

<div class="container-fluid py-3">
  <div class="row g-3">
    <div class="col-12 col-lg-3 col-xl-2">
      <div class="sticky-sidebar">
        <div class="card mb-3">
          <div class="card-header py-2">节点 (BU_)</div>
          <div class="card-body">
            <div class="mb-2">
              <input id="inpNode" type="text" class="form-control form-control-sm" placeholder="新增节点名，回车添加">
            </div>
            <div id="nodeList" class="text-muted small">ECU Vector__XXX</div>
          </div>
        </div>
        <div class="card mb-3">
          <div class="card-header py-2">消息列表</div>
          <div class="list-group list-group-flush" id="msgList"></div>
        </div>
        <div class="card mb-3">
          <div class="card-header py-2">值表 (VAL_TABLE_)</div>
          <div class="card-body">
            <div class="input-group input-group-sm mb-2">
              <input id="vtName" type="text" class="form-control" placeholder="表名">
              <button id="vtAdd" class="btn btn-outline-secondary">添加/更新</button>
            </div>
            <textarea id="vtItems" rows="4" class="form-control form-control-sm mb-2" placeholder='每行: 数值 空格 "文本"'></textarea>
            <div id="vtList" class="text-muted small">(无)</div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-12 col-lg-9 col-xl-10">
      <div class="card mb-3">
        <div class="card-header py-2">项目信息</div>
        <div class="card-body">
          <div class="row g-2 align-items-center">
            <div class="col-auto"><label for="inpVersion" class="col-form-label col-form-label-sm">VERSION</label></div>
            <div class="col-6 col-md-4 col-lg-3"><input id="inpVersion" type="text" class="form-control form-control-sm" value="1.0"></div>
          </div>
        </div>
      </div>
      <div class="card mb-3" id="msgEditor" style="display:none">
        <div class="card-header py-2">消息编辑</div>
        <div class="card-body">
          <div class="row g-2 mb-2">
            <div class="col-sm-3"><label class="form-label form-label-sm">CAN ID</label><input id="mCanId" type="text" class="form-control form-control-sm"></div>
            <div class="col-sm-3"><label class="form-label form-label-sm">名称</label><input id="mName" type="text" class="form-control form-control-sm"></div>
            <div class="col-sm-2"><label class="form-label form-label-sm">DLC</label><input id="mDlc" type="number" min="0" max="8" class="form-control form-control-sm" value="8"></div>
            <div class="col-sm-2"><label class="form-label form-label-sm">发送节点</label><input id="mTx" type="text" class="form-control form-control-sm" value="ECU"></div>
            <div class="col-sm-2"><label class="form-label form-label-sm">扩展帧</label><select id="mExt" class="form-select form-select-sm"><option value="0">否</option><option value="1">是</option></select></div>
            <div class="col-12"><label class="form-label form-label-sm">备注 (CM_)</label><input id="mComment" type="text" class="form-control form-control-sm"></div>
          </div>
          <div class="table-responsive">
            <table class="table table-bordered table-sm align-middle mb-0" id="sigGrid">
              <thead class="table-light">
                <tr><th>信号名</th><th>start</th><th>len</th><th>端序</th><th>符号</th><th>factor</th><th>offset</th><th>min</th><th>max</th><th>unit</th><th>接收</th><th>值表</th><th>备注</th><th>操作</th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-header py-2">导出预览</div>
        <div class="card-body">
          <textarea id="preview" rows="12" class="form-control font-monospace"></textarea>
          <div class="text-muted small mt-2">提示：<span class="badge text-bg-light">Ctrl</span> + <span class="badge text-bg-light">S</span> 亦可导出</div>
        </div>
      </div>
    </div>
  </div>
</div>
<div id="errOverlay" class="err-overlay" aria-live="polite"></div>
<script src="jquery.min.js"></script>
<script src="bootstrap.min.js"></script>
<script src="app.js" defer></script>
</body>
</html>
