<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>四框互转 · 进制转换器</title>
<style>
  :root{--bg:#0b0f10;--panel:#0f1518;--fg:#d9f2ff;--muted:#8aa7b3;--acc:#5cc8ff;--err:#ff6b6b;--ok:#6ee7a8;--bor:1px solid rgba(92,200,255,.25);--r:14px;--shadow:0 10px 30px rgba(0,0,0,.35)}
  *{box-sizing:border-box}
  body{margin:0;background:radial-gradient(1200px 1200px at 10% -10%,rgba(92,200,255,.12),transparent 40%),var(--bg);color:var(--fg);font-family:ui-monospace,Consolas,Menlo,monospace}
  .wrap{max-width:980px;margin:0 auto;padding:18px}
  header{position:sticky;top:0;background:linear-gradient(180deg,rgba(11,15,16,.95),rgba(11,15,16,.65));border-bottom:1px solid rgba(92,200,255,.18);backdrop-filter:blur(6px)}
  h1{font-size:20px;margin:6px 0 2px}
  p{margin:0;color:var(--muted);font-size:12px}
  .grid{display:grid;gap:12px;margin-top:14px}
  .card{background:var(--panel);border:var(--bor);border-radius:var(--r);padding:14px;box-shadow:var(--shadow)}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
  .field{display:grid;grid-template-columns:1fr auto;gap:10px}
  input[type=text]{width:100%;background:#0b1114;border:var(--bor);border-radius:12px;padding:10px;color:var(--fg);font-size:14px;outline:none}
  input[type=text].bad{border-color:rgba(255,107,107,.6);box-shadow:0 0 0 2px rgba(255,107,107,.15)}
  .hint{font-size:12px;color:var(--muted)}
  .error{font-size:12px;color:var(--err);min-height:1.2em}
  .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;background:#0c1317;border:var(--bor);color:var(--fg);border-radius:12px;cursor:pointer;user-select:none}
  .btn:hover{border-color:rgba(92,200,255,.55)}
  .two{display:grid;gap:12px;grid-template-columns:1fr 1fr}
  @media (max-width:820px){.two{grid-template-columns:1fr}}
</style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>四框互转 · 进制转换器</h1>
      <p>Bin / Oct / Dec / Hex 四个输入框互相转换。支持 <code>-</code> 号、空格与下划线分组（会被忽略）。不支持小数。</p>
    </div>
  </header>

  <main class="wrap grid">
    <section class="card two">
      <div>
        <label>二进制 (Bin)</label>
        <div class="field"><input id="bin" type="text" placeholder="如 1010_1111" inputmode="numeric" autocomplete="off"/><button class="btn" data-copy="bin">复制</button></div>
        <div class="row"><span class="hint">允许 0/1、可含前缀 0b</span><span class="error" id="err-bin"></span></div>
      </div>
      <div>
        <label>八进制 (Oct)</label>
        <div class="field"><input id="oct" type="text" placeholder="如 755 或 0o755" inputmode="numeric" autocomplete="off"/><button class="btn" data-copy="oct">复制</button></div>
        <div class="row"><span class="hint">允许 0-7、可含前缀 0o</span><span class="error" id="err-oct"></span></div>
      </div>
      <div>
        <label>十进制 (Dec)</label>
        <div class="field"><input id="dec" type="text" placeholder="如 -255" inputmode="numeric" autocomplete="off"/><button class="btn" data-copy="dec">复制</button></div>
        <div class="row"><span class="hint">允许 0-9</span><span class="error" id="err-dec"></span></div>
      </div>
      <div>
        <label>十六进制 (Hex)</label>
        <div class="field"><input id="hex" type="text" placeholder="如 FF 或 0xFF" autocomplete="off"/><button class="btn" data-copy="hex">复制</button></div>
        <div class="row"><span class="hint">允许 0-9 A-F、可含前缀 0x</span><span class="error" id="err-hex"></span></div>
      </div>
    </section>

    <section class="card row">
      <button class="btn" id="btn-clear">清空</button>
      <button class="btn" id="btn-sample">示例填充</button>
      <span class="hint">任意框输入/粘贴后，其他框自动同步。输入非法字符会标红并显示原因。</span>
    </section>
  </main>

<script>
(function(){
  const $ = id => document.getElementById(id);
  const ids = ['bin','oct','dec','hex'];
  const bases = { bin:2, oct:8, dec:10, hex:16 };
  const errEl = { bin: $('err-bin'), oct: $('err-oct'), dec: $('err-dec'), hex: $('err-hex') };
  const inputs = { bin: $('bin'), oct: $('oct'), dec: $('dec'), hex: $('hex') };

  const rx = {
    bin: /^[-+]?((0b)?[01][01_\s]*)?$/i,
    oct: /^[-+]?((0o)?[0-7][0-7_\s]*)?$/i,
    dec: /^[-+]?([0-9][0-9_\s]*)?$/,
    hex: /^[-+]?((0x)?[0-9a-f][0-9a-f_\s]*)?$/i,
  };

  function sanitize(s){ return (s||'').replace(/[\s_]/g,''); }
  function stripPrefixById(id, s){
    const t = s.toLowerCase();
    if(id==='bin' && t.startsWith('0b')) return s.slice(2);
    if(id==='oct' && t.startsWith('0o')) return s.slice(2);
    if(id==='hex' && t.startsWith('0x')) return s.slice(2);
    return s;
  }

  function parseToBigInt(id){
    let raw = inputs[id].value.trim();
    if(!raw){ return null; }
    // validate basic pattern
    if(!rx[id].test(raw)){
      return { error: '包含非法字符或格式' };
    }
    // sign
    let sign = 1n;
    if(raw.startsWith('+')) raw = raw.slice(1);
    else if(raw.startsWith('-')){ sign = -1n; raw = raw.slice(1); }
    raw = stripPrefixById(id, raw);
    raw = sanitize(raw);
    if(!raw) return null;

    const base = BigInt(bases[id]);
    let val = 0n;
    for(const ch of raw){
      const v = parseInt(ch, bases[id]);
      if(Number.isNaN(v)) return { error: `无效字符 “${ch}”` };
      val = val * base + BigInt(v);
    }
    return sign * val;
  }

  function toBaseString(n, base){
    const B = BigInt(base);
    let sign = '';
    let x = n;
    if(x < 0n){ sign = '-'; x = -x; }
    if(x === 0n) return '0';
    let s = '';
    while(x > 0n){
      const r = Number(x % B);
      s = (r < 10 ? String(r) : 'abcdef'[r-10]) + s;
      x = x / B;
    }
    return sign + s;
  }

  let updating = false;
  function updateFrom(sourceId){
    if(updating) return; updating = true;
    // 清错误
    for(const k of ids){ inputs[k].classList.remove('bad'); errEl[k].textContent=''; }

    const v = parseToBigInt(sourceId);
    if(v === null){ // 为空：清空其他
      for(const k of ids){ if(k!==sourceId) inputs[k].value=''; }
      updating = false; return;
    }
    if(typeof v === 'object' && v.error){
      inputs[sourceId].classList.add('bad');
      errEl[sourceId].textContent = v.error;
      updating = false; return;
    }

    const n = v; // BigInt
    inputs.bin.value = toBaseString(n,2);
    inputs.oct.value = toBaseString(n,8);
    inputs.dec.value = n.toString(10);
    inputs.hex.value = toBaseString(n,16).toUpperCase();

    updating = false;
  }

  // 绑定输入事件（input 实时触发）
  for(const id of ids){ inputs[id].addEventListener('input', ()=> updateFrom(id)); }

  // 复制按钮
  document.querySelectorAll('[data-copy]').forEach(btn=>{
    const id = btn.getAttribute('data-copy');
    btn.addEventListener('click', ()=>{
      const val = inputs[id].value.trim(); if(!val) return;
      navigator.clipboard?.writeText(val);
    });
  });

  // 清空/示例
  document.getElementById('btn-clear').onclick = ()=>{ for(const id of ids){ inputs[id].value=''; errEl[id].textContent=''; inputs[id].classList.remove('bad'); } };
  document.getElementById('btn-sample').onclick = ()=>{ inputs.hex.value = '0x1F_A'; updateFrom('hex'); };
})();
</script>
</body>
</html>
